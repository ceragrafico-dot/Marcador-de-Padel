<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marcador P√°del Mejorado</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: monospace;
      position: relative;
      background: 
        linear-gradient(rgba(0,0,0,0.35), rgba(0,0,0,0.35)),
        url('https://cdn.pixabay.com/photo/2021/05/05/15/29/padel-6231327_1280.jpg')
        no-repeat center center/cover;
      color: white;
    }

    #marcador {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(0,0,0,0.6);
      padding: 20px 40px;
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.8);
      backdrop-filter: blur(6px);
      z-index: 2;
    }

    #equipos {
      display: flex;
      justify-content: space-between;
      width: 100%;
      font-size: 2em;
      margin-bottom: 10px;
    }

    #puntos {
      display: flex;
      justify-content: space-between;
      width: 100%;
      font-size: 5em;
    }

    #sets {
      display: flex;
      justify-content: space-between;
      width: 100%;
      font-size: 1.5em;
      margin-top: 10px;
    }

    .equipo {
      text-align: center;
      flex: 1;
    }

    #botones {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      z-index: 2;
    }

    button {
      background: rgba(255,255,255,0.2);
      border: 2px solid white;
      color: white;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: rgba(255,255,255,0.4);
    }

    #historialContainer {
      background: rgba(0,0,0,0.6);
      color: white;
      margin-top: 25px;
      padding: 15px 25px;
      border-radius: 12px;
      font-family: monospace;
      font-size: 1em;
      width: 90%;
      max-width: 700px;
      overflow-y: auto;
      max-height: 200px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
      z-index: 2;
    }

    #historialContainer h3 {
      margin: 0 0 10px 0;
      text-align: center;
    }

    #cronometro {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      font-family: monospace;
      font-size: 1.2em;
      z-index: 3;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      text-align: center;
    }

    #cronometro button {
      margin-top: 5px;
      margin-right: 4px;
      border: none;
      border-radius: 5px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.9em;
    }

    #cronometro button:nth-child(1) { background: lime; }
    #cronometro button:nth-child(2) { background: orange; }
    #cronometro button:nth-child(3) { background: red; color: white; }

  </style>
</head>
<body>
  <div id="marcador">
    <div id="equipos">
      <div class="equipo" id="nombreHome">HOME</div>
      <div class="equipo" id="nombreGuest">GUEST</div>
    </div>
    <div id="puntos">
      <div class="equipo" id="puntosHome">0</div>
      <div class="equipo" id="puntosGuest">0</div>
    </div>
    <div id="sets">
      <div class="equipo" id="setsHome">0 0 0</div>
      <div class="equipo" id="setsGuest">0 0 0</div>
    </div>
  </div>

  <div id="botones">
    <button onclick="sumar('home')">+ HOME</button>
    <button onclick="restar('home')">- HOME</button>
    <button onclick="sumar('guest')">+ GUEST</button>
    <button onclick="restar('guest')">- GUEST</button>
    <button onclick="reset()">RESET</button>
    <button onclick="deshacer()">UNDO</button>
  </div>

  <div id="historialContainer">
    <h3>üìú Historial</h3>
    <div id="historialLista"></div>
  </div>

  <div id="cronometro">
    ‚è± <span id="tiempo">00:00</span><br>
    <button onclick="iniciarCrono()">‚ñ∂</button>
    <button onclick="pausarCrono()">‚è∏</button>
    <button onclick="reiniciarCrono()">‚ü≤</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    // üî• Configura tu Firebase:
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_AUTH_DOMAIN",
      databaseURL: "TU_DATABASE_URL",
      projectId: "TU_PROJECT_ID",
      storageBucket: "TU_STORAGE_BUCKET",
      messagingSenderId: "TU_SENDER_ID",
      appId: "TU_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const puntos = [0, 15, 30, 40, 'P'];
    let indexHome = 0, indexGuest = 0;
    let setsHome = [0, 0, 0];
    let setsGuest = [0, 0, 0];
    let setActual = 0;
    let historial = [];

    function actualizarDisplay() {
      document.getElementById("puntosHome").textContent = puntos[indexHome];
      document.getElementById("puntosGuest").textContent = puntos[indexGuest];
      document.getElementById("setsHome").textContent = setsHome.join(' ');
      document.getElementById("setsGuest").textContent = setsGuest.join(' ');
    }

    function syncData() {
      db.ref("marcador").set({
        indexHome, indexGuest, setsHome, setsGuest, setActual
      });
    }

    function guardarHistorial() {
      const entrada = {
        home: puntos[indexHome],
        guest: puntos[indexGuest],
        setsHome: [...setsHome],
        setsGuest: [...setsGuest],
        timestamp: new Date().toLocaleTimeString()
      };
      db.ref("historial").push(entrada);
    }

    function mostrarHistorial(data) {
      const contenedor = document.getElementById("historialLista");
      contenedor.innerHTML = "";
      const registros = Object.values(data || {});
      registros.slice(-10).reverse().forEach(item => {
        const div = document.createElement("div");
        div.textContent = `${item.timestamp} ‚Üí HOME ${item.setsHome.join('-')} (${item.home}) vs GUEST ${item.setsGuest.join('-')} (${item.guest})`;
        contenedor.appendChild(div);
      });
    }

    db.ref("historial").on("value", snapshot => {
      mostrarHistorial(snapshot.val());
    });

    db.ref("marcador").on("value", snapshot => {
      const data = snapshot.val();
      if (!data) return;
      indexHome = data.indexHome;
      indexGuest = data.indexGuest;
      setsHome = data.setsHome;
      setsGuest = data.setsGuest;
      setActual = data.setActual;
      actualizarDisplay();
    });

    function sumar(equipo) {
      historial.push({indexHome, indexGuest, setsHome: [...setsHome], setsGuest: [...setsGuest], setActual});
      if (equipo === "home") {
        indexHome++;
        if (indexHome >= puntos.length) {
          setsHome[setActual]++;
          indexHome = 0;
          indexGuest = 0;
          if (setsHome[setActual] >= 6) setActual++;
        }
      } else {
        indexGuest++;
        if (indexGuest >= puntos.length) {
          setsGuest[setActual]++;
          indexHome = 0;
          indexGuest = 0;
          if (setsGuest[setActual] >= 6) setActual++;
        }
      }
      actualizarDisplay();
      syncData();
      guardarHistorial();
    }

    function restar(equipo) {
      if (equipo === "home" && indexHome > 0) indexHome--;
      if (equipo === "guest" && indexGuest > 0) indexGuest--;
      actualizarDisplay();
      syncData();
    }

    function reset() {
      indexHome = 0;
      indexGuest = 0;
      setsHome = [0, 0, 0];
      setsGuest = [0, 0, 0];
      setActual = 0;
      actualizarDisplay();
      syncData();
    }

    function deshacer() {
      const prev = historial.pop();
      if (!prev) return;
      indexHome = prev.indexHome;
      indexGuest = prev.indexGuest;
      setsHome = prev.setsHome;
      setsGuest = prev.setsGuest;
      setActual = prev.setActual;
      actualizarDisplay();
      syncData();
    }

    // üïí Cron√≥metro
    let tiempoSegundos = 0;
    let intervalo = null;

    function actualizarTiempo() {
      const minutos = String(Math.floor(tiempoSegundos / 60)).padStart(2, "0");
      const segundos = String(tiempoSegundos % 60).padStart(2, "0");
      document.getElementById("tiempo").textContent = `${minutos}:${segundos}`;
    }

    function iniciarCrono() {
      if (intervalo) return;
      intervalo = setInterval(() => {
        tiempoSegundos++;
        actualizarTiempo();
      }, 1000);
    }

    function pausarCrono() {
      clearInterval(intervalo);
      intervalo = null;
    }

    function reiniciarCrono() {
      clearInterval(intervalo);
      intervalo = null;
      tiempoSegundos = 0;
      actualizarTiempo();
    }

    actualizarDisplay();
  </script>
</body>
</html>
